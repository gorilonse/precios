/*********************************
 * Diciembre**
 **********************************/
 const listaDic2022 = {
  listaSalvador: {
    Cable: [
      {
        titulo: "TV",
        precio: [2790, 2232, 1953, 1670],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go/IPTV",
        precio: [740,592, 518, 440],
        porcentajes: ["0%", "30%", "40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 420,
      },
      { titulo: "Futbol", precio: 1535 },
      { titulo: "HBO", precio: 868 },
      { titulo: "Adultos", precio: 300 },
      { titulo: "IP Fija", precio: 3600 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [3790, 3032, 2941,2653, 2150],
        porcentajes: ["0%", "20%","22.4%", "30%", "40%"],
      },
      {
        titulo: "UI-776 Internet 100MB",
        precio: [4250, 3400, 2975,2550 ,2150],
        porcentajes: ["0%", "20%", "30%", "40%","50%"],
      },
      {
        titulo: "migrar/UI-740 Internet 100MB",
        precio: [5250, 4200, 3675,3150],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },

      {
        titulo: "Internet 200MB",
        precio: [5900,3650],
        porcentajes: ["0%","40%"],
      },
      {
        titulo: "Internet 300MB",
        precio: [6940,4290],
        porcentajes: ["0%","40%"],
      },
      {
        titulo: "Internet 500MB",
        precio: 22280,
      },
      {
        titulo: "migrar/Internet 10MB",
        precio: 2790,
      },
      {
        titulo: "migrar/Internet 20MB",
        precio: 2940,
      },
      {
        titulo: "migrar/Internet 30MB",
        precio: 3080,
        
      },
     
    ],
  },
  listaPalpala: {
    Cable: [
      {
        titulo: "TV",
        precio: [1930, 1544, 1351, 1160],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [650, 520, 455, 390],
        porcentajes: ["0%", "30%", "39%","40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 340,

      },
      { titulo: "Futbol", precio: 1535 },
      { titulo: "HBO", precio: 868 },
      { titulo: "Adultos", precio: 300 },
{ titulo: "IP Fija", precio: 3200 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [2990,2691,2392 ,2093, 1790],
        porcentajes: ["0%","10%", "20%", "30%", "40%"],
      },
      {
        titulo: "UI-788	Internet 100MB",
        precio: [4310, 3448, 3017, 2586 , 2155],
        porcentajes: ["0%", "20%", "30%", "40%","50%"],
      },
     {
        titulo: "UI-721	Internet 100MB",
        precio: [4060 ,3248 ,2842 ,2436],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 200MB",
        precio: [5890, 3640],
        porcentajes: ["0%","40%"],
      },
      {
        titulo: "Internet 300MB",
        precio: [6940,4290],
        porcentajes: ["0%","40%"],
      },
      {
        titulo: "migrar/Internet 20MB",
        precio: 2700,
      },
    ],
  },
};
/*********************************
 * Octubre**
 **********************************/
 const listaOct2022 = {
  listaSalvador: {
    Cable: [
      {
        titulo: "TV",
        precio: [2450, 1960, 1715, 1470],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [650, 455, 390],
        porcentajes: ["0%", "30%", "40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 300,
      },
      { titulo: "Futbol", precio: 1535 },
      { titulo: "HBO", precio: 868 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [3330, 2664, 2585,2331, 2000],
        porcentajes: ["0%", "20%","22.4%", "30%", "40%"],
      },
      {
        titulo: "UI-776 Internet 100MB",
        precio: [4250, 3400, 2975,2550 ,2150],
        porcentajes: ["0%", "20%", "30%", "40%","50%"],
      },
      {
        titulo: "UI-740 Internet 100MB",
        precio: [4600, 3680, 3220,2760],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },

      {
        titulo: "Internet 200MB",
        precio: [5180,2930],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 300MB",
        precio: [6090,3440],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 500MB",
        precio: 19550,
      },
      {
        titulo: "Internet 10MB",
        precio: 2450,
      },
      {
        titulo: "Internet 20MB",
        precio: 2580,
      },
      {
        titulo: "Internet 30MB",
        precio: 3100,
        
      },
     
    ],
  },
  listaPalpala: {
    Cable: [
      {
        titulo: "TV",
        precio: [1700, 1360, 1190, 1020],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [570, 399, 350,342],
        porcentajes: ["0%", "30%", "39%","40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 300,

      },
      { titulo: "Futbol", precio: 1535 },
      { titulo: "HBO", precio: 868 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [2630,2366 ,2104, 1841, 1580],
        porcentajes: ["0%","10%", "20%", "30%", "40%"],
      },
      {
        titulo: "UI-788	Internet 100MB",
        precio: [3780, 3024, 2646,2268 ,1890],
        porcentajes: ["0%", "20%", "30%", "40%","50%"],
      },
     {
        titulo: "UI-721	Internet 100MB",
        precio: [4060 ,3248 ,2842 ,2436],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 200MB",
        precio: [5180,2930],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 300MB",
        precio: [6090,3440],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 20MB",
        precio: 2370,
      },
    ],
  },
};
/*********************************
 * Septiembre**
 **********************************/
 const listaSep2022 = {
  listaSalvador: {
    Cable: [
      {
        titulo: "TV",
        precio: [2450, 1960, 1715, 1470],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [650, 455, 390],
        porcentajes: ["0%", "30%", "40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 300,
      },
      { titulo: "Futbol", precio: 1120 },
      { titulo: "HBO", precio: 630 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [3330, 2664, 2585,2331, 2000],
        porcentajes: ["0%", "20%","22.4%", "30%", "40%"],
      },
      {
        titulo: "Internet 100MB",
        precio: [4250, 3400, 2975,2550 ,2150],
        porcentajes: ["0%", "20%", "30%", "40%","50%"],
      },

      {
        titulo: "Internet 200MB",
        precio: [5180,2930],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 300MB",
        precio: [6090,3440],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 500MB",
        precio: 19550,
      },
      {
        titulo: "Internet 10MB",
        precio: 2130,
      },
      {
        titulo: "Internet 20MB",
        precio: 2250,
      },
      {
        titulo: "Internet 30MB",
        precio: 3100,
        
      },
     
    ],
  },
  listaPalpala: {
    Cable: [
      {
        titulo: "TV",
        precio: [1700, 1360, 1190, 1020],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [570, 399, 350,342],
        porcentajes: ["0%", "30%", "39%","40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 300,

      },
      { titulo: "Futbol", precio: 1120 },
      { titulo: "HBO", precio: 630 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [2630,2366 ,2104, 1841, 1580],
        porcentajes: ["0%","10%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 100MB",
        precio: [3780, 3024, 2646,2268 ,1890],
        porcentajes: ["0%", "20%", "30%", "40%","50%"],
      },
      {
        titulo: "Internet 200MB",
        precio: [5180,2930],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 300MB",
        precio: [6090,3440],
        porcentajes: ["0%","45%"],
      },
      {
        titulo: "Internet 20MB",
        precio: 2370,
      },
    ],
  },
};
/*********************************
 * Marzo**
 **********************************/
const listaMar2022 = {
  listaSalvador: {
    Cable: [
      {
        titulo: "TV",
        precio: [1900, 1520, 1330, 1159],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [500, 350, 300],
        porcentajes: ["0%", "30%", "40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 280,
      },
      { titulo: "Futbol", precio: 1120 },
      { titulo: "HBO", precio: 630 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [2600, 2080, 1820, 1540],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 100MB",
        precio: [3570, 2856, 2499, 2099],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 10MB",
        precio: 1900,
      },
      {
        titulo: "Internet 20MB",
        precio: 2000,
      },
      {
        titulo: "Internet 30MB",
        precio: 2760,
      },
      { titulo: "Internet 200MB", precio: 7000 },
    ],
  },
  listaPalpala: {
    Cable: [
      {
        titulo: "TV",
        precio: [1320, 1056, 924, 800],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [450, 315, 270],
        porcentajes: ["0%", "30%", "40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 230,

      },
      { titulo: "Futbol", precio: 1120 },
      { titulo: "HBO", precio: 630 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 20MB",
        precio: [1840, 1472, 1288],
        porcentajes: ["0%", "20%", "30%"],
      },
      {
        titulo: "Internet 50MB",
        precio: [2040, 1632, 1428, 1220],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 100MB",
        precio: [3150, 2520, 2205, 1880],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
    ],
  },
};

/*********************************
 * Junio**
 **********************************/

const listaJun2022 = {
  listaSalvador: {
    Cable: [
      {
        titulo: "TV",
        precio: [2130, 1704, 1491, 1280],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [560, 392, 330],
        porcentajes: ["0%", "30%", "40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 320,
      },
      { titulo: "Futbol", precio: 1290 },
      { titulo: "HBO", precio: 630 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 50MB",
        precio: [2900, 2320, 2030, 1740],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 100MB",
        precio: [3700, 2960, 2590, 2220],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 10MB",
        precio: 2130,
      },
      {
        titulo: "Internet 20MB",
        precio: 2250,
      },
      {
        titulo: "Internet 30MB",
        precio: 3100,
      },
      { titulo: "Internet 200MB", precio: [4500,2250],
       porcentajes: ["0%","50%"]},
      { titulo: "Internet 300MB", precio: [5300,2650] ,
      porcentajes: ["0%","50%"]},
      { titulo: "Internet 500MB", precio: 17000 },
    ],
  },
  listaPalpala: {
    Cable: [
      {
        titulo: "TV",
        precio: [1480, 1184, 1036, 890],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Go",
        precio: [500,350, 300],
        porcentajes: ["0%", "30%", "40%"],
      },
      {
        titulo: "Go Adicional",
        precio: 260,
      },
      { titulo: "Futbol", precio: 1290 },
      { titulo: "HBO", precio: 630 },
      { titulo: "Adultos", precio: 300 },
    ],
    Internet: [
      {
        titulo: "Internet 20MB",
        precio: 2060,
      },
      {
        titulo: "Internet 50MB",
        precio: [2290, 1832, 1603, 1370],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
      {
        titulo: "Internet 100MB",
        precio: [3290, 2632, 2303, 1970],
        porcentajes: ["0%", "20%", "30%", "40%"],
      },
    ],
  },
};

let carritoMap = new Map();
let localidad = document.querySelector("#localidad");
let listaMes = document.querySelector("#lista");

let obListas = {
  listaDic2022,
  listaOct2022,
  listaSep2022,
  listaJun2022,
  listaMar2022
}
/************************************************************************
_____________________Cambio y dibujo___________________________________
*************************************************************************/

window.onload = ()=>{  
  actualizarItems(localidad.selectedOptions[0].value,listaMes.selectedOptions[0].value);
  carritoMap.clear();
  actualizarTabla(carritoMap);
}

localidad.addEventListener("change", (e) => {
  listaMes = document.querySelector("#lista");
  actualizarItems(e.target.selectedOptions[0].value,listaMes.selectedOptions[0].value);
  carritoMap.clear();
  actualizarTabla(carritoMap);
});
listaMes.addEventListener("change", (e) => {
  localidad = document.querySelector("#localidad");
  actualizarItems(localidad.selectedOptions[0].value,e.target.selectedOptions[0].value);
  carritoMap.clear();
  actualizarTabla(carritoMap);
});


//@param localidad mes
/**
 * @param localidad
 * @param mes
 */
let actualizarItems = (vLocalidad,vListaMes) => {
  listass = obListas[vListaMes][vLocalidad];


  const listaLocalidad = Object.entries(listass);
  listaLocalidad.map((tipoPrecios) => {
    let tipo = tipoPrecios[0];
    let templateRecuadro = document.getElementById("template-recuadro").content;
    let templateStepper = document.getElementById("template-stepper").content;
    let template;
    const fragment = document.createDocumentFragment();
    let container;

    if (tipo === "Cable") {
      container = document.querySelector(".wrapper-cable");
    } else {
      container = document.querySelector(".wrapper-internet");
    }
    elementos = tipoPrecios[1];
    elementos.map((item) => {
      if (Array.isArray(item.precio)) {
        template = templateStepper;
        template.getElementById("porcentaje").textContent = "0%";
        template
          .querySelector(".stepper")
          .setAttribute("porcentajes", item.porcentajes);
        template.querySelector(".stepper").setAttribute("indice", 0);

        if (container.classList.contains("wrapper-internet")) {
          itemStart = template.querySelector(".item");
          itemStart.classList.add("start");
        } else {
          itemStart = template.querySelector(".item");
          itemStart.classList.remove("start");
        }
      } else {
        template = templateRecuadro;
      }
      template.getElementById("nombre").textContent = item.titulo;
      template.querySelector(".item").setAttribute("value", item.precio);
      template.querySelector(".item").setAttribute("id", item.titulo);

      const clone = template.cloneNode(true);
      fragment.appendChild(clone);
    });
    container.innerHTML = "";
    container.appendChild(fragment);
  });
};

/************************************************************************
___________________________Event Listener_____________________________
*************************************************************************/

document.addEventListener("click", (e) => {
  //############### Stepper###############
  if (e.target.textContent === "add") {
    agrega = true;
    cambiarPorcentaje(agrega, e);
  }
  if (e.target.textContent === "remove") {
    agrega = false;
    cambiarPorcentaje(agrega, e);
  }

  //recuadro

  if (e.target.classList.contains("item")) {
    elm = e.target.parentNode;
    activated(elm, true);
  }
  if (e.target.parentNode.classList.contains("item")) {
    elm = e.target.parentNode.parentNode;
    activated(elm, true);
  }
}); 
/************************************************************************
___________________________Funcionalidad_____________________________
*************************************************************************/
let cambiarPorcentaje = (agrega, e) => {
  let recuadroActual = e.target.parentNode.parentNode;
  let stepperActual = e.target.parentNode;
  let porcentajesArray = stepperActual.getAttribute("porcentajes").split(",");
  let indice = parseInt(stepperActual.getAttribute("indice"));

  if (agrega) {
    indice < porcentajesArray.length - 1 ? indice++ : (indice = 0);
  } else {
    indice > 0 ? indice-- : (indice = porcentajesArray.length - 1);
  }
  stepperActual.setAttribute("indice", indice);
  porcentajesData = stepperActual.querySelector("#porcentaje");
  porcentajesData.textContent = porcentajesArray[indice];
  activated(recuadroActual, false);
};

let activated = (elemento, toggle) => {
  nombre = elemento.firstElementChild.getAttribute("id");
  precios = elemento.firstElementChild.getAttribute("value").split(",");
  indice = parseInt(elemento.lastElementChild.getAttribute("indice"));
  bandera = true;
  if (elemento.parentElement.classList.contains("wrapper-internet")) {
    hermanos = elemento.parentElement.children;
    for (let hermano of hermanos) {
      if (hermano.classList.contains("active")) {
        hermano === elemento ? null : hermano.classList.toggle("active");
        hnombre = hermano.firstElementChild.getAttribute("id");
        hprecios = hermano.firstElementChild.getAttribute("value").split(",");
        hindice = parseInt(hermano.lastElementChild.getAttribute("indice"));
        hbandera = false;
        hhijos = hermano.children;
        hprecio = hprecios[0];
        if (hhijos.length > 1) {
          indice = parseInt(hermano.lastElementChild.getAttribute("indice"));
          hdescuento = hprecios[indice];
        } else {
          hdescuento = hprecio;
        }
        hdiferencia = hprecio - hdescuento;

        actualizarTabla(hnombre, hprecio, hdiferencia, hdescuento, hbandera);
      }
    }
  }

  toggle
    ? (bandera = elemento.classList.toggle("active"))
    : elemento.classList.add("active");
  hijos = elemento.children;
  precio = precios[0];
  if (hijos.length > 1) {
    indice = parseInt(elemento.lastElementChild.getAttribute("indice"));
    descuento = precios[indice];
  } else {
    descuento = precio;
  }
  diferencia = precio - descuento;
  actualizarTabla(nombre, precio, diferencia, descuento, bandera);
};

/************************************************************************
--------------- Manipulación de la tabla --------------------
*************************************************************************/
let actualizarTabla = (nombre, precio, descuento, final, abm) => {
  abm
    ? carritoMap.set(nombre, [precio, descuento, final])
    : carritoMap.delete(nombre);
  carritoOrdenado = Array.from(carritoMap).sort();
  let container = document.querySelector(".table-container");
  var tabla = document.createElement("table");
  let tablaBody = document.querySelector("tBody");
  let tbodie = "";
  for (let [key, value] of carritoMap) {
    tbodie += `<tr>
    <td>${key}</td>
    <td>$${value[0]}</td>
    <td>- $${value[1]}</td>
    <td>$${value[2]}</td>
  </tr>`;
  }
  tablaBody.innerHTML = tbodie;

  fTablaTotal(carritoMap);
};

fTablaTotal = (map) => {
  let totales = [0, 0, 0];
  map.forEach((element) => {
    totales[0] += parseInt(element[0]);
    totales[1] += parseInt(element[1]);
    totales[2] += parseInt(element[2]);
  });
  let tablaFoot = document.querySelector("tfoot");
  let tfoot = "";
  tfoot += `<tr>
    <td>Total</td>
    <td>$${totales[0]}</td>
    <td>- $${totales[1]}</td>
    <td>$${totales[2]}</td>
  </tr>`;
  tablaFoot.innerHTML = tfoot;
  document.getElementById("descuentos").innerHTML = ` $${totales[2]}`;
  document.getElementById("montoDescuento").innerHTML = ` -$${totales[1]}`;
  document.getElementById("total").innerHTML = ` $${totales[0]}`;
};
